
## 打包

### 说明
1. 打包前需要切换到包对应的项目分支，确保分支git干净，改提交的都提交了。
2. 打包后不要提交为了打包修改的文档和文件
3. 打包后不要提交为了打包修改的文档和文件
4. 打包后不要提交为了打包修改的文档和文件

### 打包相关资源
1. 打包资源放在根目录的“项目打包静态资源”文件夹里了
2. 快捷打包脚本，放在与项目平级的文件夹中

### 打包步骤

#### package.json 文件调整。
1. 从 项目打包静态资源 对应项目的 配置.text 中找到对应字段
2. 替换package.json中的项目名（例：沟通），替换为配置.text中的项目名（例：筱苼通讯），共有5处
3. 替换package.json中的appId字段（例：top.Tigase.im.goutong），替换为配置.text中的appid（例：top.Tigase.im.xiaosheng）

#### /src/config/SystemConfig.ts 文件调整
1. 替换 apiUrl 字段（例：http://103.82.143.76:8093），替换为配置.text中的的接口地址（例：https://api.whwgdok.xyz）


#### 替换 /pablic 文件夹中的图片资源
1. 替换 2561.ico
2. 替换 logo.png
3. 替换 noti.png
4. 替换 stay.png

#### 替换 /src/assets/image 文件夹中的图片资源
1. 替换 login-banner.png

#### 打包
1. 执行 npm run packWin
2. 打包完成后可以在 /dist 目录中找到新的 .exe安装文件，这个就是新的包
3. 撤销掉打包所需的更改，不要提交（现在版本不稳定，经常需要所有项目一起调整，等后期稳定之后可以项目单独配置打包内容）










以下为旧文档
----------------------------------------------
----------------------------------------------

## 电脑端打包说明

### 开发环境
 nodejs 11~12 (推荐v12.13.1)

### 安装依赖
``` bash
npm install
```

### 重装依赖(不是必须的,如果npm install不成功,可以尝试重装)
``` bash
rm -rf node_modules
rm package-lock.json
npm cache clear --force
npm install
```

### 修改服务器地址
src/config/SystemConfig.ts 
``` ts
// 接口地址(只修改此处即可)
export const apiUrl: string = "xx.xx";
// 节点的ip
export const apiSwitchUrl: string = "xx.xx";
```
config/webpackDevServer.config.js 
``` js 
target: 'http://api.xx.xx/',
```
SystemStore 

### 修改应用名称/版本/appid
package.json 
``` json
"name": "demo",
"version": "1.0.0",
"description": "商旅通产品",
"productName": "商旅通产品",
"uninstallDisplayName": "商旅通产品",
"shortcutName": "商旅通产品",
"appId": "top.Tigase.im.demo",
```

### 修改应用图标
> 256x256.ico
> logo.icns 
> logo.png 
> noti.png
> stay.png

### 本地运行
``` bash
# 本地编译项目代码为js
npm run start

# win环境运行(在另一个终端下)
npm run start-win

# mac环境运行(在另一个终端下), 命令自己打开 electron
npm run start-electron
```

### 打包dmg和exe
``` bash
# 编译主进程main.ts 以及预加载的renderer.ts 文件
npm run build-main-release

# win打包(输出dist目录)
npm run packWin

# mac打包(输出dist目录)
npm run packMac
```

### 如果mobx错误,建议安装5.14.2版本
``` bash
# mobx推荐使用5.14.2版本
npm uninstall mobx
npm install mobx@5.14.2 
```

### 如果electron错误,建议安装7.3.0版本
``` bash
# electron推荐使用7.3.0版本
npm uninstall electron
npm install electron@7.3.0
```
调试运行
npm run dev